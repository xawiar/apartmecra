const f=()=>window.location.origin,S=f(),$=(e,r,t="site")=>{const s=e.substring(0,3).toUpperCase().replace(/İ/g,"I").replace(/Ğ/g,"G").replace(/Ü/g,"U").replace(/Ş/g,"S").replace(/Ö/g,"O").replace(/Ç/g,"C");return t==="business_center"?`IM${s}${r}`:`${s}${r}`},P=(e,r)=>`${e.substring(0,3).toUpperCase().replace(/İ/g,"I").replace(/Ğ/g,"G").replace(/Ü/g,"U").replace(/Ş/g,"S").replace(/Ö/g,"O").replace(/Ç/g,"C")}${r}`,I=(e,r)=>{const t=new Date(e),s=String(t.getDate()).padStart(2,"0"),a=String(t.getMonth()+1).padStart(2,"0"),o=t.getFullYear();return`${r}${s}${a}${String(o).slice(-2)}`},T=async(e,r)=>{try{const t=`${e}@company.local`,s=r.phone||e,a={username:e,password:s,role:"company",companyId:e,status:"active",email:t};await n("/users",{method:"POST",body:JSON.stringify(a)}),console.log("Company user created:",a)}catch(t){console.error("Error creating company user:",t)}},v=async(e,r)=>{try{const t=`${e}@site.local`,s=r.phone||e,a={username:e,password:s,role:"site_user",siteId:e,status:"active",email:t};await n("/users",{method:"POST",body:JSON.stringify(a)}),console.log("Site user created:",a)}catch(t){console.error("Error creating site user:",t)}},n=async(e,r={})=>{try{const s=new AbortController,a=setTimeout(()=>s.abort(),5e3),o=await fetch(`${S}${e}`,{headers:{"Content-Type":"application/json",...r.headers},signal:s.signal,...r});if(clearTimeout(a),!o.ok)throw new Error(`HTTP error! status: ${o.status}`);return await o.json()}catch(s){throw s.name==="AbortError"?(console.error("API call timeout:",e),new Error("Sunucuya bağlanılamadı. Lütfen JSON Server'ın çalıştığından emin olun (Port 3001).")):(console.error("API call failed:",s),s)}},A=async(e,r)=>{try{console.log("Local API login called with:",e);const t=await n(`/users?username=${encodeURIComponent(e)}&password=${encodeURIComponent(r)}`);if(t&&t.length>0){const s=t[0];return{token:"local-token-"+Date.now(),user:{username:s.username,role:s.role,siteId:s.siteId||null,companyId:s.companyId||null,id:s.id}}}else return{error:"Geçersiz kimlik bilgileri"}}catch(t){return console.error("Local API login error:",t),{error:"Bağlantı hatası: Sunucuya ulaşılamıyor"}}},b=async(e,r)=>({success:!0}),O=async()=>{try{const[e,r,t,s]=await Promise.all([n("/sites"),n("/companies"),n("/agreements"),n("/transactions")]),a=t.filter(i=>i.status==="active"),o=r.filter(i=>i.status==="active"),c=s.filter(i=>i.type==="income").reduce((i,u)=>i+(u.amount||0),0),l=Math.abs(s.filter(i=>i.type==="expense").reduce((i,u)=>i+(u.amount||0),0)),g=c-l;return{activeSites:e.filter(i=>i.status!=="archived").length,activeCompanies:o.length,activeAgreements:a.length,totalRevenue:c,totalExpenses:l,netCash:g}}catch(e){return console.error("Error fetching dashboard summary:",e),{activeSites:0,activeCompanies:0,activeAgreements:0,totalRevenue:0,totalExpenses:0,netCash:0}}},C=async(e=5)=>{try{return(await n("/transactions")).slice(0,e)}catch(r){return console.error("Error fetching recent transactions:",r),[]}},N=async()=>{try{return(await n("/sites")).filter(r=>r.status!=="archived")}catch(e){return console.error("Error fetching sites:",e),[]}},U=async e=>{try{const t=(await n("/sites")).length+1,s=$(e.name,t,e.siteType),a={...e,id:s,sequenceNumber:t},o=await n("/sites",{method:"POST",body:JSON.stringify(a)});return o&&await v(s,e),o}catch(r){throw console.error("Error creating site:",r),r}},J=async(e,r)=>{try{return await n(`/sites/${e}`,{method:"PUT",body:JSON.stringify(r)})}catch(t){return console.error("Error updating site:",t),null}},L=async e=>{try{return await n(`/sites/${e}`,{method:"DELETE"}),!0}catch(r){return console.error("Error deleting site:",r),!1}},D=async e=>{try{const t={...await n(`/sites/${e}`),status:"archived",archivedAt:new Date().toISOString()};return await n(`/sites/${e}`,{method:"PUT",body:JSON.stringify(t)}),{success:!0}}catch(r){return console.error("Error archiving site:",r),{success:!1,error:r.message}}},x=async()=>{try{return await n("/companies")}catch(e){return console.error("Error fetching companies:",e),[]}},k=async e=>{try{const t=(await n("/companies")).length+1,s=P(e.name,t),a={...e,id:s,sequenceNumber:t},o=await n("/companies",{method:"POST",body:JSON.stringify(a)});return o&&await T(s,e),o}catch(r){return console.error("Error creating company:",r),null}},R=async(e,r)=>{try{return await n(`/companies/${e}`,{method:"PUT",body:JSON.stringify(r)})}catch(t){return console.error("Error updating company:",t),null}},j=async e=>{try{return await n(`/companies/${e}`,{method:"DELETE"}),!0}catch(r){return console.error("Error deleting company:",r),!1}},q=async e=>{try{const t={...await n(`/companies/${e}`),status:"archived",archivedAt:new Date().toISOString()};return await n(`/companies/${e}`,{method:"PUT",body:JSON.stringify(t)}),{success:!0}}catch(r){return console.error("Error archiving company:",r),{success:!1,error:r.message}}},F=async()=>{try{return await n("/agreements")}catch(e){return console.error("Error fetching agreements:",e),[]}},M=async e=>{try{const t=(await n("/agreements")).length+1,s=I(e.startDate,t),a={...e,id:s,sequenceNumber:t};return await n("/agreements",{method:"POST",body:JSON.stringify(a)})}catch(r){return console.error("Error creating agreement:",r),null}},_=async(e,r)=>{try{return await n(`/agreements/${e}`,{method:"PUT",body:JSON.stringify(r)})}catch(t){return console.error("Error updating agreement:",t),null}},z=async e=>{try{return await n(`/agreements/${e}`,{method:"DELETE"}),!0}catch(r){return console.error("Error deleting agreement:",r),!1}},B=async e=>{try{const t={...await n(`/agreements/${e}`),status:"archived",archivedAt:new Date().toISOString()};return await n(`/agreements/${e}`,{method:"PUT",body:JSON.stringify(t)}),{success:!0}}catch(r){return console.error("Error archiving agreement:",r),{success:!1,error:r.message}}},G=async()=>{try{return await n("/transactions")}catch(e){return console.error("Error fetching transactions:",e),[]}},H=async e=>{try{return await n("/transactions",{method:"POST",body:JSON.stringify(e)})}catch(r){return console.error("Error creating transaction:",r),null}},Y=async(e,r)=>{try{return await n(`/transactions/${e}`,{method:"PUT",body:JSON.stringify(r)})}catch(t){return console.error("Error updating transaction:",t),null}},K=async e=>{try{return await n(`/transactions/${e}`,{method:"DELETE"}),!0}catch(r){return console.error("Error deleting transaction:",r),!1}},Q=async()=>{try{return await n("/partners")}catch(e){return console.error("Error fetching partners:",e),[]}},V=async e=>{try{return await n("/partners",{method:"POST",body:JSON.stringify(e)})}catch(r){return console.error("Error creating partner:",r),null}},W=async(e,r)=>{try{return await n(`/partners/${e}`,{method:"PUT",body:JSON.stringify(r)})}catch(t){return console.error("Error updating partner:",t),null}},X=async e=>{try{return await n(`/partners/${e}`,{method:"DELETE"}),!0}catch(r){return console.error("Error deleting partner:",r),!1}},Z=async()=>{try{return(await n("/sites")).filter(r=>r.status==="archived")}catch(e){return console.error("Error fetching archived sites:",e),[]}},ee=async()=>{try{return(await n("/companies")).filter(r=>r.status==="archived")}catch(e){return console.error("Error fetching archived companies:",e),[]}},re=async()=>{try{return(await n("/agreements")).filter(r=>r.status==="archived")}catch(e){return console.error("Error fetching archived agreements:",e),[]}},te=async e=>{try{return await n(`/sites/${e}`,{method:"DELETE"}),!0}catch(r){return console.error("Error deleting archived site:",r),!1}},ne=async e=>{try{return await n(`/companies/${e}`,{method:"DELETE"}),!0}catch(r){return console.error("Error deleting archived company:",r),!1}},se=async e=>{try{return await n(`/agreements/${e}`,{method:"DELETE"}),!0}catch(r){return console.error("Error deleting archived agreement:",r),!1}},oe=async e=>{try{const t={...await n(`/sites/${e}`)};return delete t.status,delete t.archivedAt,await n(`/sites/${e}`,{method:"PUT",body:JSON.stringify(t)}),!0}catch(r){return console.error("Error restoring site:",r),!1}},ae=async e=>{try{const t={...await n(`/companies/${e}`)};return delete t.status,delete t.archivedAt,await n(`/companies/${e}`,{method:"PUT",body:JSON.stringify(t)}),!0}catch(r){return console.error("Error restoring company:",r),!1}},ce=async e=>{try{const t={...await n(`/agreements/${e}`)};return delete t.status,delete t.archivedAt,await n(`/agreements/${e}`,{method:"PUT",body:JSON.stringify(t)}),!0}catch(r){return console.error("Error restoring agreement:",r),!1}},ie=async()=>{try{return await n("/users")}catch(e){return console.error("Error fetching users:",e),[]}},le=async e=>{try{return await n("/users",{method:"POST",body:JSON.stringify(e)})}catch(r){throw console.error("Error creating user:",r),r}},ue=async(e,r)=>{try{return await n(`/users/${e}`,{method:"PUT",body:JSON.stringify(r)})}catch(t){return console.error("Error updating user:",t),null}},ge=async e=>{try{return await n(`/users/${e}`,{method:"DELETE"}),!0}catch(r){return console.error("Error deleting user:",r),!1}},de=async e=>{try{const[r,t,s]=await Promise.all([n(`/sites/${e}`),n("/agreements"),n("/transactions")]),a=t.filter(c=>c.siteIds&&c.siteIds.includes(e)),o=s.filter(c=>{var l,g,i;return c.type==="expense"&&((l=c.source)==null?void 0:l.includes("Site Ödemesi"))&&((g=c.source)==null?void 0:g.includes(r.name))||c.type==="income"&&((i=c.source)==null?void 0:i.includes("Anlaşma Ödemesi"))&&a.some(u=>{var d;return(d=c.source)==null?void 0:d.includes(u.id)})});return{site:r,agreements:a,transactions:o}}catch(r){return console.error("Error fetching site data:",r),{site:null,agreements:[],transactions:[]}}},me=async e=>{try{return(await n("/agreements")).filter(t=>t.siteIds&&t.siteIds.includes(e))}catch(r){return console.error("Error fetching site agreements:",r),[]}},ye=async e=>{try{const[r,t,s]=await Promise.all([n("/transactions"),n(`/sites/${e}`),n("/agreements")]),a=s.filter(o=>o.siteIds&&o.siteIds.includes(e));return r.filter(o=>{var c,l,g;return o.type==="expense"&&((c=o.source)==null?void 0:c.includes("Site Ödemesi"))&&((l=o.source)==null?void 0:l.includes(t.name))||o.type==="income"&&((g=o.source)==null?void 0:g.includes("Anlaşma Ödemesi"))&&a.some(i=>{var u;return(u=o.source)==null?void 0:u.includes(i.id)})})}catch(r){return console.error("Error fetching site transactions:",r),[]}},he=async()=>{try{return await n("/logs")}catch(e){return console.error("Error fetching logs:",e),[]}},pe=async e=>{try{return await n("/logs",{method:"POST",body:JSON.stringify(e)})}catch(r){return console.error("Error creating log:",r),null}},we=async e=>{try{return await n(`/logs/${e}`,{method:"DELETE"}),!0}catch(r){return console.error("Error deleting log:",r),!1}},Ee=async()=>{try{const e=await fetch("http://localhost:3001/panelImages");if(!e.ok)throw new Error("Failed to fetch panel images");const r=await e.json();return console.log("getPanelImages called - returning images:",r),r}catch(e){return console.error("Error fetching panel images:",e),[]}},fe=async e=>{try{const r=e.get("agreementId"),t=e.get("siteId"),s=e.get("blockId"),a=e.get("panelId"),o=e.get("companyId"),c=e.get("image"),l=Date.now(),g=Math.round(Math.random()*1e9),i=c.name.split(".").pop(),u=`panel-${r}-${t}-${s}-${a}-${l}-${g}.${i}`,d=await new Promise((w,E)=>{const m=new FileReader;m.onload=()=>w(m.result),m.onerror=E,m.readAsDataURL(c)}),y={filename:u,originalName:c.name,size:c.size,url:d,agreementId:r,siteId:t,blockId:s,panelId:a,companyId:o,uploadedAt:new Date().toISOString()},h=await fetch("http://localhost:3001/panelImages",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(y)});if(!h.ok)throw new Error("Failed to upload panel image");const p=await h.json();return console.log("uploadPanelImage called - returning result:",p),{success:!0,message:"Image uploaded successfully",imageUrl:y.url,imageInfo:p}}catch(r){throw console.error("Error uploading panel image:",r),r}},Se=async()=>{try{const e=await fetch("http://localhost:3001/panelImages");if(!e.ok)throw new Error("Failed to fetch panel images");const r=await e.json();return await Promise.all(r.map(t=>fetch(`http://localhost:3001/panelImages/${t.id}`,{method:"DELETE"}).catch(()=>null))),{success:!0,deletedCount:r.length}}catch(e){return console.error("Error resetting panel images (local):",e),{success:!1,error:e.message}}},$e=async()=>(console.log("cleanupExpiredImages called - returning mock response"),{message:"Cleanup completed. Deleted 0 expired images.",deletedCount:0}),Pe=e=>(e(null),()=>{}),Ie=()=>null,Te=e=>!0,ve=e=>!0,Ae=e=>!0,be=async()=>{try{return await n("/accountingRecords")}catch(e){return console.error("Error fetching accounting records:",e),[]}},Oe=async e=>{try{return await n("/accountingRecords",{method:"POST",body:JSON.stringify(e)})}catch(r){return console.error("Error creating accounting record:",r),null}};export{B as archiveAgreement,q as archiveCompany,D as archiveSite,Ae as canAccessCompany,ve as canAccessSite,b as changePassword,$e as cleanupExpiredImages,Oe as createAccountingRecord,M as createAgreement,k as createCompany,pe as createLog,V as createPartner,U as createSite,H as createTransaction,le as createUser,z as deleteAgreement,se as deleteArchivedAgreement,ne as deleteArchivedCompany,te as deleteArchivedSite,j as deleteCompany,we as deleteLog,X as deletePartner,L as deleteSite,K as deleteTransaction,ge as deleteUser,be as getAccountingRecords,F as getAgreements,re as getArchivedAgreements,ee as getArchivedCompanies,Z as getArchivedSites,x as getCompanies,Ie as getCurrentUser,O as getDashboardSummary,he as getLogs,Ee as getPanelImages,Q as getPartners,C as getRecentTransactions,me as getSiteAgreements,de as getSiteData,ye as getSiteTransactions,N as getSites,G as getTransactions,ie as getUsers,Te as hasPermission,A as login,Pe as onAuthStateChange,Se as resetPanelImages,ce as restoreAgreement,ae as restoreCompany,oe as restoreSite,_ as updateAgreement,R as updateCompany,W as updatePartner,J as updateSite,Y as updateTransaction,ue as updateUser,fe as uploadPanelImage};
