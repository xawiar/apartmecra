import{be as i,bf as d,bg as p,bh as u,M as $,$ as w,bi as g,a$ as f,aK as y,ao as D,bj as A,a4 as F,a8 as x,b1 as b,bk as M,bl as _}from"./index-8c9f38c9.js";import"./vendor-06819936.js";const I={PANEL_IMAGES:"panel-images",COMPANY_LOGO:"company-logos",SITE_IMAGES:"site-images",AGREEMENT_DOCS:"agreement-documents"},U=async(e,t)=>{try{const{agreementId:a,siteId:r,blockId:s,panelId:o,companyId:c}=t,l=e.name.split(".").pop(),n=`panel-${a}-${r}-${s}-${o}.${l}`,m=i(d,`${I.PANEL_IMAGES}/${n}`),h=await p(m,e),E=await u(h.ref),R={filename:n,originalName:e.name,size:e.size,url:E,agreementId:a,siteId:r,blockId:s,panelId:o,companyId:c,uploadedAt:new Date().toISOString(),storagePath:h.ref.fullPath},S=await $(w(g,"panelImages"),R);return{success:!0,message:"Image uploaded successfully",imageUrl:E,imageInfo:{id:S.id,...R}}}catch(a){return console.error("Error uploading panel image:",a),{success:!1,error:"Failed to upload image: "+a.message}}},P=async(e={})=>{try{let t=w(g,"panelImages");const a=[];e.agreementId&&a.push(f("agreementId","==",e.agreementId)),e.siteId&&a.push(f("siteId","==",e.siteId)),e.companyId&&a.push(f("companyId","==",e.companyId)),a.length>0?t=y(t,...a):t=y(t);const r=await D(t),s=[];return r.forEach(o=>{s.push({id:o.id,...o.data()})}),{success:!0,data:s}}catch(t){return console.error("Error fetching panel images:",t),{success:!1,error:t.message,data:[]}}},L=async e=>{try{const t=await D(y(w(g,"panelImages"),f("__name__","==",e)));if(t.empty)return{success:!1,error:"Image not found"};const a=t.docs[0].data(),r=i(d,a.storagePath);return await A(r),await F(x(g,"panelImages",e)),{success:!0,message:"Image deleted successfully"}}catch(t){return console.error("Error deleting panel image:",t),{success:!1,error:"Failed to delete image: "+t.message}}},T=async()=>{try{const e=await P();if(!e.success)return{success:!1,error:"Failed to fetch images"};const t=e.data;let a=0;for(const r of t)(await L(r.id)).success&&a++;return{success:!0,deletedCount:a}}catch(e){return console.error("Error resetting panel images:",e),{success:!1,error:"Failed to reset panel images: "+e.message}}},z=async()=>{try{const{getAgreements:e}=await b(()=>import("./firebaseDb-cdf0b9a6.js").then(n=>n.Q),["assets/firebaseDb-cdf0b9a6.js","assets/index-8c9f38c9.js","assets/vendor-06819936.js","assets/index-14ec5823.css"]),t=await e(),a=new Date,s=t.filter(n=>n.endDate?new Date(n.endDate)<a:!1).map(n=>n.id),o=await P();if(!o.success)return{success:!1,error:"Failed to fetch images"};const c=o.data;let l=0;for(const n of c)s.includes(n.agreementId)&&(await L(n.id)).success&&l++;return{success:!0,message:`Cleanup completed. Deleted ${l} expired images.`,deletedCount:l}}catch(e){return console.error("Error cleaning up expired images:",e),{success:!1,error:"Failed to cleanup expired images: "+e.message}}},G=async(e,t)=>{try{const a=Date.now(),r=e.name.split(".").pop(),s=`logo-${t}-${a}.${r}`,o=i(d,`${I.COMPANY_LOGO}/${s}`),c=await p(o,e);return{success:!0,url:await u(c.ref),filename:s}}catch(a){return console.error("Error uploading company logo:",a),{success:!1,error:"Failed to upload logo: "+a.message}}},N=async(e,t)=>{try{const a=Date.now(),r=e.name.split(".").pop(),s=`site-${t}-${a}.${r}`,o=i(d,`${I.SITE_IMAGES}/${s}`),c=await p(o,e);return{success:!0,url:await u(c.ref),filename:s}}catch(a){return console.error("Error uploading site image:",a),{success:!1,error:"Failed to upload site image: "+a.message}}},k=async(e,t)=>{try{const a=Date.now(),r=e.name.split(".").pop(),s=`agreement-${t}-${a}.${r}`,o=i(d,`${I.AGREEMENT_DOCS}/${s}`),c=await p(o,e),l=await u(c.ref),n={filename:s,originalName:e.name,size:e.size,url:l,agreementId:t,uploadedAt:new Date().toISOString(),storagePath:c.ref.fullPath},m=await $(w(g,"agreementDocuments"),n);return{success:!0,url:l,filename:s,documentId:m.id}}catch(a){return console.error("Error uploading agreement document:",a),{success:!1,error:"Failed to upload document: "+a.message}}},q=async(e,t,a={})=>{try{const r=Date.now(),s=Math.round(Math.random()*1e9),o=e.name.split(".").pop(),c=`${r}-${s}.${o}`,l=i(d,`${t}/${c}`),n=await p(l,e);return{success:!0,url:await u(n.ref),filename:c,path:n.ref.fullPath,size:e.size,metadata:a}}catch(r){return console.error("Error uploading file:",r),{success:!1,error:"Failed to upload file: "+r.message}}},j=async e=>{try{const t=i(d,e);return await A(t),{success:!0,message:"File deleted successfully"}}catch(t){return console.error("Error deleting file:",t),{success:!1,error:"Failed to delete file: "+t.message}}},v=async e=>{try{const t=i(d,e),a=await M(t),r=[];for(const s of a.items)try{const o=await _(s),c=await u(s);r.push({name:s.name,fullPath:s.fullPath,size:o.size,contentType:o.contentType,timeCreated:o.timeCreated,updated:o.updated,url:c})}catch(o){console.warn("Error getting metadata for file:",s.name,o)}return{success:!0,files:r}}catch(t){return console.error("Error listing files:",t),{success:!1,error:t.message,files:[]}}},Y=async e=>{try{const t=i(d,e),a=await _(t),r=await u(t);return{success:!0,metadata:{name:a.name,size:a.size,contentType:a.contentType,timeCreated:a.timeCreated,updated:a.updated,url:r}}}catch(t){return console.error("Error getting file metadata:",t),{success:!1,error:t.message}}};export{z as cleanupExpiredImages,j as deleteFile,L as deletePanelImage,Y as getFileMetadata,P as getPanelImages,v as listFiles,T as resetAllPanelImages,k as uploadAgreementDocument,G as uploadCompanyLogo,q as uploadFile,U as uploadPanelImage,N as uploadSiteImage};
