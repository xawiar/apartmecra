import{bm as U,bn as se,bo as te,bp as re,bq as ae,M as N,$ as h,bi as m,aP as E,a8 as T,al as M,aY as O,a4 as C,aK as g,a$ as y,aG as oe,av as ne,ao as w,b1 as S,b0 as B}from"./index-8c9f38c9.js";const _={ADMIN:"admin",SITE_MANAGER:"site_manager",COMPANY_MANAGER:"company_manager",OBSERVER:"observer",PERSONNEL:"personnel"},ce=async(e,s)=>{var r,t,n;try{console.log("ðŸ” Attempting login with:",e);const d=(await te(U,e,s)).user;console.log("âœ… Login successful:",d.uid);const u=await d.getIdToken();console.log("ðŸŽ« Token obtained:",u?"Yes":"No");let o=_.ADMIN,c=null,l=null,p=((r=d.email)==null?void 0:r.split("@")[0])||"user";return e.includes("@site.local")?(o=_.SITE_USER,c=e.replace("@site.local",""),p=c):e.includes("@company.local")?(o=_.COMPANY,l=e.replace("@company.local",""),p=l):e.includes("@personnel.local")&&(o=_.PERSONNEL,p=e.replace("@personnel.local","")),{success:!0,user:{uid:d.uid,email:d.email,username:p,role:o,siteId:c,companyId:l,status:"active"},token:u}}catch(a){return console.error("âŒ Login error:",a),console.error("Error code:",a.code),console.error("Error message:",a.message),(a.code==="auth/invalid-credential"||(t=a.message)!=null&&t.includes("400")||(n=a.message)!=null&&n.includes("Bad Request"))&&(a.code==="auth/invalid-credential"||console.error("Bad Request error - possible causes: invalid email format, empty password, or API key issue")),{success:!1,error:K(a.code)||"GiriÅŸ yapÄ±lÄ±rken bir hata oluÅŸtu. LÃ¼tfen bilgilerinizi kontrol edin."}}},ie=async()=>{try{return await re(U),console.log("âœ… Logout successful"),{success:!0}}catch(e){return console.error("âŒ Logout error:",e),{success:!1,error:e.message}}},ue=()=>U.currentUser,le=e=>se(U,e),de=(e,s)=>e?e.role===_.ADMIN:!1,pe=(e,s)=>e?e.role===_.ADMIN?!0:e.siteId===s:!1,me=(e,s)=>e?e.role===_.ADMIN?!0:e.companyId===s:!1,G=async(e,s,r={})=>{try{console.log("Creating user with email:",e);const n=(await ae(U,e,s)).user;return console.log("User created successfully:",n.uid),{success:!0,user:{uid:n.uid,email:n.email,...r}}}catch(t){return console.error("User creation error:",t),{success:!1,error:K(t.code)}}},he=async()=>{try{return console.log("ðŸ”§ Initializing admin user..."),!0}catch(e){return console.error("âŒ Error initializing admin user:",e),!1}},K=e=>{const s={"auth/user-not-found":"KullanÄ±cÄ± bulunamadÄ±","auth/wrong-password":"YanlÄ±ÅŸ ÅŸifre","auth/invalid-email":"GeÃ§ersiz email adresi","auth/user-disabled":"KullanÄ±cÄ± hesabÄ± devre dÄ±ÅŸÄ±","auth/too-many-requests":"Ã‡ok fazla deneme yapÄ±ldÄ±, lÃ¼tfen daha sonra tekrar deneyin","auth/network-request-failed":"AÄŸ baÄŸlantÄ±sÄ± hatasÄ±","auth/invalid-credential":"GeÃ§ersiz kimlik bilgileri","auth/operation-not-allowed":"Bu iÅŸlem izin verilmiyor","auth/weak-password":"Åžifre Ã§ok zayÄ±f","auth/invalid-argument":"GeÃ§ersiz parametre","auth/missing-password":"Åžifre gereklidir","auth/email-already-in-use":"Bu email adresi zaten kullanÄ±lÄ±yor"};return!e||e.includes("400")||e.includes("Bad Request")?"GeÃ§ersiz istek. LÃ¼tfen email ve ÅŸifrenizi kontrol edin.":s[e]||`GiriÅŸ hatasÄ±: ${e||"Bilinmeyen hata"}`},fe=async e=>{try{return console.log("ðŸ—‘ï¸ Deleting user from Firebase Auth:",e),console.log("âš ï¸ User deletion requires Firebase Admin SDK"),console.log("Please delete user manually from Firebase Console:"),console.log("https://console.firebase.google.com/project/apartmecraelazig/authentication/users"),{success:!1,error:"Admin SDK required for user deletion"}}catch(s){return console.error("Error deleting user from Auth:",s),{success:!1,error:s.message}}},ts=Object.freeze(Object.defineProperty({__proto__:null,USER_ROLES:_,canAccessCompany:me,canAccessSite:pe,createUserWithEmail:G,deleteUserFromAuth:fe,getCurrentUser:ue,hasPermission:de,initializeAdminUser:he,loginWithEmail:ce,logoutUser:ie,onAuthStateChange:le},Symbol.toStringTag,{value:"Module"})),D=async(e,s,r=null)=>({success:!0}),i={USERS:"users",SITES:"sites",COMPANIES:"companies",AGREEMENTS:"agreements",TRANSACTIONS:"transactions",PARTNERS:"partners",ARCHIVED_SITES:"archivedSites",ACCOUNTING_RECORDS:"accountingRecords",ARCHIVED_COMPANIES:"archivedCompanies",ARCHIVED_AGREEMENTS:"archivedAgreements",LOGS:"logs",PANEL_IMAGES:"panelImages"},R=async(e,s)=>{try{const t=(await N(h(m,e),{...s,createdAt:E(),updatedAt:E()})).id,n=s&&s.id?s.id:t,a={success:!0,id:t,data:{...s,id:n,_docId:t}};return await D("create",{id:n,_docId:t,...s},e),a}catch(r){return console.error(`Error creating document in ${e}:`,r),{success:!1,error:r.message}}},P=async(e,s)=>{try{const r=T(m,e,s),t=await M(r);return t.exists()?{success:!0,data:{id:t.id,...t.data()}}:{success:!1,error:"Document not found"}}catch(r){return console.error(`Error getting document from ${e}:`,r),{success:!1,error:r.message}}},I=async(e,s,r)=>{try{const t=T(m,e,s);if(!(await M(t)).exists())return console.error(`Document ${s} not found in ${e}, cannot update`),{success:!1,error:`Document ${s} not found in ${e}`};await O(t,{...r,updatedAt:E()});const a=await M(t),d=a.exists()?a.data():r,u={success:!0,data:{id:s,_docId:s,...d}};return await D("update",{id:s,...d},e),u}catch(t){return console.error(`Error updating document in ${e}:`,t),{success:!1,error:t.message}}},b=async(e,s)=>{try{const r=T(m,e,s),t=await M(r),n=t.exists()?t.data():null;await C(r);const a={success:!0};return n&&await D("delete",{id:s,...n},e),a}catch(r){return console.error(`Error deleting document from ${e}:`,r),{success:!1,error:r.message}}},A=async(e,s=[],r=null,t="asc",n=null)=>{try{let a=h(m,e);s.forEach(o=>{a=g(a,y(o.field,o.operator,o.value))}),r&&(a=g(a,oe(r,t))),n&&(a=g(a,ne(n)));const d=await w(a),u=[];return d.forEach(o=>{const c=o.data();u.push({_docId:o.id,...c,id:c.id||o.id})}),{success:!0,data:u}}catch(a){return console.error(`Error getting collection ${e}:`,a),{success:!1,error:a.message,data:[]}}},Y=async()=>((await A(i.SITES,[],"name","asc")).data||[]).filter(r=>r.status!=="archived"),ge=async()=>(await A(i.ARCHIVED_SITES,[],"archivedAt","desc")).data||[],ye=async e=>{const s=await V(i.SITES),r=Ke(e.name,s,e.siteType),t={...e,id:r,sequenceNumber:s},n=await R(i.SITES,t);return n.success&&await Z(r,e),n},we=async(e,s)=>{try{let r=e,t=null;const n=await P(i.SITES,e);if(!n.success||!n.data){const l=h(m,i.SITES),p=g(l,y("id","==",e)),f=await w(p);if(f.empty)return{success:!1,error:"Site not found"};{const v=f.docs[0];r=v.id,t=v.data()}}else t=n.data;const a=(t==null?void 0:t.phone)||"",d=s.phone||"",u=a!==d&&d;let o={...s};if(s.blocks!==void 0||s.elevatorsPerBlock!==void 0){const l=parseInt(s.blocks)||parseInt(t==null?void 0:t.blocks)||0,p=parseInt(s.elevatorsPerBlock)||parseInt(t==null?void 0:t.elevatorsPerBlock)||0,f=l*p,v=f*2;o={...o,elevators:f,panels:v}}else o={...o,elevators:t==null?void 0:t.elevators,panels:t==null?void 0:t.panels};const c=await I(i.SITES,r,o);if(u&&c.success)try{const l=(t==null?void 0:t.id)||e,p=`${l}@site.local`;console.log(`Updating site user password: ${p} (siteId: ${l}, oldPhone: ${a}, newPhone: ${d})`);const f=h(m,i.USERS),v=g(f,y("email","==",p)),F=await w(v);if(F.empty)console.warn(`âš ï¸ Site user not found in users collection: ${p}`);else{const k=F.docs[0];await O(k.ref,{password:d,updatedAt:new Date}),console.log(`âœ… User document password updated in Firestore: ${p}`);const{getFunctions:x,httpsCallable:z}=await S(()=>import("./index.esm-70930f54.js"),["assets/index.esm-70930f54.js","assets/index-8c9f38c9.js","assets/vendor-06819936.js","assets/index-14ec5823.css"]),{auth:j}=await S(()=>import("./index-8c9f38c9.js").then(ee=>ee.bs),["assets/index-8c9f38c9.js","assets/vendor-06819936.js","assets/index-14ec5823.css"]),H=x(),$=await z(H,"updateUserPasswordByEmail")({email:p,newPassword:d});$.data&&$.data.success?console.log(`âœ… Site user password updated in Firebase Auth: ${p}`):console.error(`âš ï¸ Failed to update password in Firebase Auth: ${p}`,$.data)}}catch(l){console.error("Error updating site user password:",l)}return c}catch(r){return console.error("Error updating site:",r),{success:!1,error:r.message}}},Ee=async e=>{try{let s=null,r=e;const t=await P(i.SITES,e);if(t.success&&t.data)s=t.data,r=e;else{const u=h(m,i.SITES),o=g(u,y("id","==",e)),c=await w(o);if(c.empty)return{success:!1,error:"Site not found"};{const l=c.docs[0];r=l.id;const p=l.data();s={_docId:l.id,...p,id:p.id||l.id}}}const n=s.siteId||s.id||e,a=`${n}@site.local`,d=await b(i.SITES,r);if(d.success){console.log(`âœ… Site ${n} (doc: ${r}) deleted from Firestore`);try{const u=h(m,i.USERS),o=g(u,y("email","==",a)),c=await w(o);if(!c.empty){const l=c.docs.map(p=>C(p.ref));await Promise.all(l),console.log(`âœ… User document(s) deleted from Firestore: ${a}`)}}catch(u){console.error(`âš ï¸ Failed to delete user document ${a}:`,u.message||u)}try{const o=await fetch("https://us-central1-apartmecra-elz.cloudfunctions.net/deleteUserByEmail",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:a})});if(o.ok){const c=await o.json();c.success?console.log(`âœ… Auth user deleted: ${a}`):console.error(`âš ï¸ Failed to delete Auth user ${a}:`,c.error)}else console.error(`âš ï¸ Failed to delete Auth user ${a}: HTTP ${o.status}`)}catch(u){console.error(`âš ï¸ Failed to delete Auth user ${a}:`,u.message||u)}return{success:!0,message:`Site and associated user ${a} deleted.`}}return d}catch(s){return console.error("Error deleting site:",s),{success:!1,error:s.message}}},Se=async e=>{try{let s=e,r=await P(i.SITES,e);if(!r.success||!r.data){const u=h(m,i.SITES),o=g(u,y("id","==",e)),c=await w(o);if(c.empty)return console.error("archiveSite: Site not found for id:",e),{success:!1,error:"Site not found"};const l=c.docs[0];s=l.id,r={success:!0,data:{id:l.id,...l.data()}}}const n={...r.data,originalDocId:s,archivedAt:E(),archivedFrom:"sites"},a=await N(h(m,i.ARCHIVED_SITES),n),d=T(m,i.SITES,s);return await C(d),console.log(`âœ… Site ${e} (doc: ${s}) archived successfully to archivedSites`),console.log(`âš ï¸ Site user ${e}@site.local login is now disabled`),{success:!0,message:"Site archived. User login disabled."}}catch(s){return console.error("Error archiving site:",s),{success:!1,error:s.message}}},J=async()=>(await A(i.COMPANIES,[{field:"status",operator:"!=",value:"archived"}],"name","asc")).data||[],Ae=async()=>(await A(i.ARCHIVED_COMPANIES,[],"archivedAt","desc")).data||[],Re=async e=>{try{const s=h(m,i.ARCHIVED_SITES),r=g(s,y("id","==",e)),t=await w(r);if(t.empty)return console.error("restoreSite: Archived site not found for id:",e),{success:!1,error:"Archived site not found"};const n=t.docs[0],a=n.data(),{originalDocId:d,archivedAt:u,archivedFrom:o,...c}=a,l=await N(h(m,i.SITES),{...c,status:"active",restoredAt:E(),updatedAt:E()});return await C(n.ref),console.log(`âœ… Site ${e} restored successfully from archivedSites`),{success:!0,message:"Site restored successfully"}}catch(s){return console.error("Error restoring site:",s),{success:!1,error:s.message}}},Pe=async e=>{try{const s=h(m,i.ARCHIVED_COMPANIES),r=g(s,y("id","==",e)),t=await w(r);if(t.empty)return console.error("restoreCompany: Archived company not found for id:",e),{success:!1,error:"Archived company not found"};const n=t.docs[0],a=n.data(),{originalDocId:d,archivedAt:u,archivedFrom:o,...c}=a,l=await N(h(m,i.COMPANIES),{...c,status:"active",restoredAt:E(),updatedAt:E()});return await C(n.ref),console.log(`âœ… Company ${e} restored successfully from archivedCompanies`),{success:!0,message:"Company restored successfully"}}catch(s){return console.error("Error restoring company:",s),{success:!1,error:s.message}}},ve=async e=>{const s=await V(i.COMPANIES),r=Ye(e.name,s),t={...e,id:r,sequenceNumber:s};return await R(i.COMPANIES,t)},Ce=async(e,s)=>{try{let r=e,t=null;const n=await P(i.COMPANIES,e);if(!n.success||!n.data){const c=h(m,i.COMPANIES),l=g(c,y("id","==",e)),p=await w(l);if(p.empty)return{success:!1,error:"Company not found"};{const f=p.docs[0];r=f.id,t=f.data()}}else t=n.data;const a=(t==null?void 0:t.phone)||"",d=s.phone||"",u=a!==d&&d,o=await I(i.COMPANIES,r,s);if(u&&o.success)try{const c=(t==null?void 0:t.id)||e,l=`${c}@company.local`;console.log(`Updating company user password: ${l} (companyId: ${c}, oldPhone: ${a}, newPhone: ${d})`);const p=h(m,i.USERS),f=g(p,y("email","==",l)),v=await w(f);if(v.empty)console.warn(`âš ï¸ Company user not found in users collection: ${l}`);else{const F=v.docs[0];await O(F.ref,{password:d,updatedAt:new Date}),console.log(`âœ… User document password updated in Firestore: ${l}`);const{getFunctions:k,httpsCallable:x}=await S(()=>import("./index.esm-70930f54.js"),["assets/index.esm-70930f54.js","assets/index-8c9f38c9.js","assets/vendor-06819936.js","assets/index-14ec5823.css"]),{auth:z}=await S(()=>import("./index-8c9f38c9.js").then($=>$.bs),["assets/index-8c9f38c9.js","assets/vendor-06819936.js","assets/index-14ec5823.css"]),j=k(),q=await x(j,"updateUserPasswordByEmail")({email:l,newPassword:d});q.data&&q.data.success?console.log(`âœ… Company user password updated in Firebase Auth: ${l}`):console.error(`âš ï¸ Failed to update password in Firebase Auth: ${l}`,q.data)}}catch(c){console.error("Error updating company user password:",c)}return o}catch(r){return console.error("Error updating company:",r),{success:!1,error:r.message}}},_e=async e=>{try{let s=null,r=e;const t=await P(i.COMPANIES,e);if(t.success&&t.data)s=t.data,r=e;else{const u=h(m,i.COMPANIES),o=g(u,y("id","==",e)),c=await w(o);if(c.empty)return{success:!1,error:"Company not found"};{const l=c.docs[0];r=l.id,s={id:l.id,...l.data()}}}const n=s.companyId||s.id||e,a=`${n}@company.local`,d=await b(i.COMPANIES,r);if(d.success){console.log(`âœ… Company ${n} (doc: ${r}) deleted from Firestore`);try{const u=h(m,i.USERS),o=g(u,y("email","==",a)),c=await w(o);if(!c.empty){const l=c.docs.map(p=>C(p.ref));await Promise.all(l),console.log(`âœ… User document(s) deleted from Firestore: ${a}`)}}catch(u){console.error(`âš ï¸ Failed to delete user document ${a}:`,u.message||u)}try{const o=await fetch("https://us-central1-apartmecra-elz.cloudfunctions.net/deleteUserByEmail",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:a})});if(o.ok){const c=await o.json();c.success?console.log(`âœ… Auth user deleted: ${a}`):console.error(`âš ï¸ Failed to delete Auth user ${a}:`,c.error)}else console.error(`âš ï¸ Failed to delete Auth user ${a}: HTTP ${o.status}`)}catch(u){console.error(`âš ï¸ Failed to delete Auth user ${a}:`,u.message||u)}return{success:!0,message:`Company and associated user ${a} deleted.`}}return d}catch(s){return console.error("Error deleting company:",s),{success:!1,error:s.message}}},be=async e=>{try{const s=await P(i.COMPANIES,e);if(!s.success)return{success:!1,error:"Company not found"};const r=s.data,t=e,n={...r,originalDocId:t,archivedAt:E(),archivedFrom:"companies"},a=await N(h(m,i.ARCHIVED_COMPANIES),n),d=T(m,i.COMPANIES,t);return await C(d),console.log(`âœ… Company ${e} (doc: ${t}) archived successfully to archivedCompanies`),console.log(`âš ï¸ Company user ${e}@company.local login is now disabled`),{success:!0,message:"Company archived. User login disabled."}}catch(s){return console.error("Error archiving company:",s),{success:!1,error:s.message}}},Q=async()=>(await A(i.AGREEMENTS,[],"startDate","desc")).data||[],Te=async e=>{const s=await V(i.AGREEMENTS),r=Je(e.startDate,s),t={...e,id:r,sequenceNumber:s};return await R(i.AGREEMENTS,t)},Ie=async(e,s)=>{try{let r=e;const t=await P(i.AGREEMENTS,e);if(!t.success||!t.data){const n=h(m,i.AGREEMENTS),a=g(n,y("id","==",e)),d=await w(a);if(!d.empty)r=d.docs[0].id;else return{success:!1,error:"Agreement not found"}}return await I(i.AGREEMENTS,r,s)}catch(r){return console.error("Error updating agreement:",r),{success:!1,error:r.message}}},W=async e=>{try{let s=null,r=e;const t=await P(i.AGREEMENTS,e);if(t.success&&t.data)s=t.data,r=e;else{const a=h(m,i.AGREEMENTS),d=g(a,y("id","==",e)),u=await w(d);if(u.empty)return{success:!1,error:"Agreement not found"};{const o=u.docs[0];r=o.id,s={id:o.id,...o.data()}}}const n=await b(i.AGREEMENTS,r);return n.success?(console.log(`âœ… Agreement ${e} (doc: ${r}) deleted from Firestore`),{success:!0,message:"Agreement deleted successfully."}):n}catch(s){return console.error("Error deleting agreement:",s),{success:!1,error:s.message}}},$e=async e=>{try{let s=e,r=null;const t=await P(i.AGREEMENTS,e);if(!t.success||!t.data){const d=h(m,i.AGREEMENTS),u=g(d,y("id","==",e)),o=await w(u);if(o.empty)return{success:!1,error:"Agreement not found"};{const c=o.docs[0];s=c.id,r=c.data()}}else r=t.data;if(!r)return{success:!1,error:"Agreement not found"};const n={...r,status:"archived",archivedAt:E()};return(await R(i.ARCHIVED_AGREEMENTS,n)).success?(await W(s),{success:!0}):{success:!1,error:"Failed to archive agreement"}}catch(s){return console.error("Error archiving agreement:",s),{success:!1,error:s.message}}},X=async()=>(await A(i.TRANSACTIONS,[],"date","desc")).data||[],Ue=async e=>await R(i.TRANSACTIONS,e),Ne=async(e,s)=>await I(i.TRANSACTIONS,e,s),Oe=async e=>await b(i.TRANSACTIONS,e),De=async()=>(await A(i.PARTNERS,[],"name","asc")).data||[],Fe=async e=>await R(i.PARTNERS,e),qe=async(e,s)=>await I(i.PARTNERS,e,s),Me=async e=>await b(i.PARTNERS,e),Ge=async()=>(await A(i.ACCOUNTING_RECORDS,[],"date","desc")).data||[],Le=async e=>{const s=await R(i.ACCOUNTING_RECORDS,e);return s.success?s.data:null},ke=async()=>(await A(i.USERS,[],"username","asc")).data||[],L=async e=>await R(i.USERS,e),xe=async(e,s)=>await I(i.USERS,e,s),Be=async e=>await b(i.USERS,e),Ve=async()=>(await A(i.LOGS,[],"timestamp","desc",100)).data||[],ze=async e=>await R(i.LOGS,{...e,timestamp:E()}),je=async e=>await b(i.LOGS,e),He=async()=>{try{const[e,s,r,t]=await Promise.all([Y(),J(),Q(),X()]),n=r.filter(c=>c.status==="active"),a=s.filter(c=>c.status==="active"),d=t.filter(c=>c.type==="income").reduce((c,l)=>c+(l.amount||0),0),u=Math.abs(t.filter(c=>c.type==="expense").reduce((c,l)=>c+(l.amount||0),0)),o=d-u;return{activeSites:e.length,activeCompanies:a.length,activeAgreements:n.length,totalRevenue:d,totalExpenses:u,netCash:o}}catch(e){return console.error("Error fetching dashboard summary:",e),{activeSites:0,activeCompanies:0,activeAgreements:0,totalRevenue:0,totalExpenses:0,netCash:0}}},V=async e=>{try{const s=await A(e,[],"sequenceNumber","desc",1);return s.success&&s.data.length>0?(s.data[0].sequenceNumber||0)+1:1}catch(s){return console.error("Error getting next sequence number:",s),1}},Ke=(e,s,r="site")=>{const t=e.substring(0,3).toUpperCase().replace(/Ä°/g,"I").replace(/Äž/g,"G").replace(/Ãœ/g,"U").replace(/Åž/g,"S").replace(/Ã–/g,"O").replace(/Ã‡/g,"C");return r==="business_center"?`IM${t}${s}`:`${t}${s}`},Ye=(e,s)=>`${e.substring(0,3).toUpperCase().replace(/Ä°/g,"I").replace(/Äž/g,"G").replace(/Ãœ/g,"U").replace(/Åž/g,"S").replace(/Ã–/g,"O").replace(/Ã‡/g,"C")}${s}`,Je=(e,s)=>{const r=new Date(e),t=String(r.getDate()).padStart(2,"0"),n=String(r.getMonth()+1).padStart(2,"0"),a=r.getFullYear();return`${s}${t}${n}${String(a).slice(-2)}`},Z=async(e,s,r=!1)=>{try{const t=`${e}@site.local`,n=s.phone&&s.phone.trim()!==""?s.phone:"123456",a={username:e,password:n,role:"site_user",siteId:e,status:"active",email:t};if(r)try{await fetch("https://us-central1-apartmecra-elz.cloudfunctions.net/deleteUserByEmail",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t})}).catch(()=>{});const l=(await w(g(h(m,"users"),y("email","==",t)))).docs.map(p=>C(p.ref));await Promise.all(l)}catch(o){console.log("Error deleting existing user (may not exist):",o.message)}const d=await w(g(h(m,"users"),y("email","==",t)));if(!d.empty&&!r)try{const{getFunctions:o,httpsCallable:c}=await S(()=>import("./index.esm-70930f54.js"),["assets/index.esm-70930f54.js","assets/index-8c9f38c9.js","assets/vendor-06819936.js","assets/index-14ec5823.css"]),{functions:l}=await S(()=>import("./index-8c9f38c9.js").then(f=>f.bs),["assets/index-8c9f38c9.js","assets/vendor-06819936.js","assets/index-14ec5823.css"]);await c(l,"updateUserPasswordByEmail")({email:t,newPassword:n}),console.log("Site user password updated in Auth:",t)}catch(o){console.warn("Failed to update password, will try to create:",o.message)}if(d.empty||r){const o=await L(a);if(!o||!o.success)throw new Error((o==null?void 0:o.error)||"Failed to create user in Firestore")}else{const o=d.docs[0];await O(o.ref,{...a,updatedAt:E()})}const u=await G(t,n,a);if(u.success)console.log("Site user created/updated in Firebase Auth:",t);else if(u.error&&u.error.includes("already exists"))try{const{getFunctions:o,httpsCallable:c}=await S(()=>import("./index.esm-70930f54.js"),["assets/index.esm-70930f54.js","assets/index-8c9f38c9.js","assets/vendor-06819936.js","assets/index-14ec5823.css"]),{functions:l}=await S(()=>import("./index-8c9f38c9.js").then(f=>f.bs),["assets/index-8c9f38c9.js","assets/vendor-06819936.js","assets/index-14ec5823.css"]);await c(l,"updateUserPasswordByEmail")({email:t,newPassword:n}),console.log("Site user password updated in Auth:",t)}catch(o){console.error("Failed to update site user password:",o)}else throw console.error("Failed to create site user in Firebase Auth:",u.error),new Error(u.error);return{success:!0,email:t,password:n}}catch(t){throw console.error("Error creating site user:",t),t}},Qe=async(e,s,r=!1)=>{try{const t=`${e}@company.local`,n=s.phone||e,a={username:e,password:n,role:"company_user",companyId:e,status:"active",email:t};if(r)try{await fetch("https://us-central1-apartmecra-elz.cloudfunctions.net/deleteUserByEmail",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t})}).catch(()=>{});const l=(await w(g(h(m,"users"),y("email","==",t)))).docs.map(p=>C(p.ref));await Promise.all(l)}catch(o){console.log("Error deleting existing user (may not exist):",o.message)}const d=await w(g(h(m,"users"),y("email","==",t)));if(!d.empty&&!r)try{const{getFunctions:o,httpsCallable:c}=await S(()=>import("./index.esm-70930f54.js"),["assets/index.esm-70930f54.js","assets/index-8c9f38c9.js","assets/vendor-06819936.js","assets/index-14ec5823.css"]),{functions:l}=await S(()=>import("./index-8c9f38c9.js").then(f=>f.bs),["assets/index-8c9f38c9.js","assets/vendor-06819936.js","assets/index-14ec5823.css"]);await c(l,"updateUserPasswordByEmail")({email:t,newPassword:n}),console.log("Company user password updated in Auth:",t)}catch(o){console.warn("Failed to update password, will try to create:",o.message)}if(d.empty||r){const o=await L(a);if(!o||!o.success)throw new Error((o==null?void 0:o.error)||"Failed to create user in Firestore")}else{const o=d.docs[0];await O(o.ref,{...a,updatedAt:E()})}const u=await G(t,n,a);if(u.success)console.log("Company user created/updated in Firebase Auth:",t);else if(u.error&&u.error.includes("already exists"))try{const{getFunctions:o,httpsCallable:c}=await S(()=>import("./index.esm-70930f54.js"),["assets/index.esm-70930f54.js","assets/index-8c9f38c9.js","assets/vendor-06819936.js","assets/index-14ec5823.css"]),{functions:l}=await S(()=>import("./index-8c9f38c9.js").then(f=>f.bs),["assets/index-8c9f38c9.js","assets/vendor-06819936.js","assets/index-14ec5823.css"]);await c(l,"updateUserPasswordByEmail")({email:t,newPassword:n}),console.log("Company user password updated in Auth:",t)}catch(o){console.error("Failed to update company user password:",o)}else throw console.error("Failed to create company user in Firebase Auth:",u.error),new Error(u.error);return{success:!0,email:t,password:n}}catch(t){throw console.error("Error creating company user:",t),t}},We=async(e,s,r={})=>{try{const t=`${e}@personnel.local`,n={username:e,password:s,role:"personnel",status:"active",email:t,...r};await L(n);const a=await G(t,s,n);return a.success?console.log("Personnel user created in Firebase Auth:",a.user.uid):console.error("Failed to create personnel user in Firebase Auth:",a.error),n}catch(t){throw console.error("Error creating personnel user:",t),t}},Xe=async(e,s)=>{try{const r=B(m);return s.forEach(t=>{const n=t(h(m,e));r.set(n,{...t,createdAt:E(),updatedAt:E()})}),await r.commit(),{success:!0}}catch(r){return console.error("Error in batch create:",r),{success:!1,error:r.message}}},Ze=async(e,s)=>{try{const r=B(m);s.forEach(n=>{const a=T(m,e,n.id);r.update(a,{...n.data,updatedAt:E()})}),await r.commit();const t={success:!0};return await D("batch_update",s,e),t}catch(r){return console.error("Error in batch update:",r),{success:!1,error:r.message}}},es=async(e,s)=>{try{const r=B(m);s.forEach(n=>{const a=T(m,e,n);r.delete(a)}),await r.commit();const t={success:!0};return await D("batch_delete",s,e),t}catch(r){return console.error("Error in batch delete:",r),{success:!1,error:r.message}}},rs=Object.freeze(Object.defineProperty({__proto__:null,COLLECTIONS:i,archiveAgreement:$e,archiveCompany:be,archiveSite:Se,batchCreate:Xe,batchDelete:es,batchUpdate:Ze,createAccountingRecord:Le,createAgreement:Te,createCompany:ve,createCompanyUser:Qe,createDocument:R,createLog:ze,createPartner:Fe,createPersonnelUser:We,createSite:ye,createSiteUser:Z,createTransaction:Ue,createUser:L,deleteAgreement:W,deleteCompany:_e,deleteDocument:b,deleteLog:je,deletePartner:Me,deleteSite:Ee,deleteTransaction:Oe,deleteUser:Be,getAccountingRecords:Ge,getAgreements:Q,getArchivedCompanies:Ae,getArchivedSites:ge,getCollection:A,getCompanies:J,getDashboardSummary:He,getDocument:P,getLogs:Ve,getPartners:De,getSites:Y,getTransactions:X,getUsers:ke,restoreCompany:Pe,restoreSite:Re,updateAgreement:Ie,updateCompany:Ce,updateDocument:I,updatePartner:qe,updateSite:we,updateTransaction:Ne,updateUser:xe},Symbol.toStringTag,{value:"Module"}));export{A,b as B,ke as C,We as D,Be as E,Ve as F,ze as G,je as H,Ge as I,Le as J,he as K,le as L,de as M,pe as N,me as O,ts as P,rs as Q,He as a,X as b,Y as c,ye as d,Ee as e,Se as f,ue as g,J as h,ve as i,Ce as j,_e as k,ce as l,be as m,Q as n,Te as o,Ie as p,W as q,$e as r,Ue as s,Ne as t,we as u,Oe as v,De as w,Fe as x,qe as y,Me as z};
